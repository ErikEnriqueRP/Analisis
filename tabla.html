<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de CSV con Gr√°ficos</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
    <link rel="stylesheet" href="styles/estilotabla.css">
</head>
<body>
    <h1>Tabla de JIRAS</h1>
    <nav class="navbar-controls">
        <div class="navbar-left">
            <div class="dropdown">
                <button class="dropdown-btn">Tabla</button>
                <div id="dropdown-tabla" class="dropdown-content">
                    <a href="#" id="btn-gestionar-columnas">üìä Gestionar Columnas</a>
                    <a href="#" id="btn-crear-grafico">üìà Crear Gr√°fico</a>
                    <a href="#" id="btn-crear-tablas-link">üìã Crear Tablas (Dashboard)</a>
                </div>
            </div>
            <div class="dropdown">
                <button class="dropdown-btn">Filtros R√°pidos</button>
                <div id="dropdown-filtros" class="dropdown-content">
                    <div class="submenu-container">
                        <a href="#">A√±o ‚ñ∂</a>
                        <div class="submenu" id="quick-filter-ano"></div>
                    </div>
                    <div class="submenu-container">
                        <a href="#">√Årea ‚ñ∂</a>
                        <div class="submenu" id="quick-filter-area"></div>
                    </div>
                    <div class="submenu-container">
                        <a href="#">Prioridad ‚ñ∂</a>
                        <div class="submenu" id="quick-filter-prioridad"></div>
                    </div>
                    <div class="submenu-container">
                        <a href="#">Estado ‚ñ∂</a>
                        <div class="submenu" id="quick-filter-estado"></div>
                    </div>
                    <div class="submenu-container">
                        <a href="#">Resoluci√≥n ‚ñ∂</a>
                        <div class="submenu" id="quick-filter-resolucion"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="navbar-right">
            <button id="resetFiltersBtn" class="btn btn-red">Limpiar Filtros</button>
            <button id="exportBtn" class="btn btn-green">Exportar a Excel</button>
        </div>
    </nav>
    
    <div id="csvTableContainer"></div>
    <div id="pagination-controls"></div>
    <div id="filterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="filterModalTitle">Filtrar por:</h2>
                <span class="close-btn" onclick="document.getElementById('filterModal').style.display='none'">&times;</span>
            </div>
            <div class="modal-body">
                <input type="text" id="filterSearchInput" placeholder="Buscar valores...">
                <div class="modal-options-toolbar">
                    <button id="selectAllBtn">Seleccionar Todo</button>
                    <button id="deselectAllBtn">Deseleccionar Todo</button>
                </div>
                <div id="filterOptions" class="modal-options-list"></div>
            </div>
            <div class="modal-footer">
                <button id="cancelFilterBtn" class="btn btn-red">Cancelar</button>
                <button id="applyFilterBtn" class="btn btn-green">Aplicar Filtro</button>
            </div>
        </div>
    </div>

    <div id="columnsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gestionar Columnas</h2>
                <span class="close-btn" onclick="document.getElementById('columnsModal').style.display='none'">&times;</span>
            </div>
            <div class="modal-body">
                <h3>Visibilidad de Columnas</h3>
                <div id="columnsList" class="modal-options-list"></div>
                <hr>
                <h3>A√±adir Columna IZQUIERDA</h3>
                <label for="leftSourceColumn">Columna Base:</label>
                <select id="leftSourceColumn"></select>
                <label for="leftNumChars">N√∫mero de Caracteres:</label>
                <input type="number" id="leftNumChars" value="2">
                <label for="leftConcatColumn">Concatenar con Columna:</label>
                <select id="leftConcatColumn"></select>
                <label for="leftNewColumnName">Nombre Nueva Columna:</label>
                <input type="text" id="leftNewColumnName">
                <label><input type="checkbox" id="leftAutoApply"> Guardar esta configuraci√≥n para futuras cargas.</label>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="document.getElementById('columnsModal').style.display='none'">Cerrar</button>
                <button id="applyLeftColumnBtn" class="btn btn-green" onclick="handleAddLeftColumn()">Aplicar y Guardar</button>
            </div>
        </div>
    </div>

    <div id="chartModal" class="modal">
        <div class="modal-content large">
             <div class="modal-header">
                <h2>Crear Gr√°fico</h2>
                <span class="close-btn" onclick="document.getElementById('chartModal').style.display='none'">&times;</span>
            </div>
            <div class="modal-body">
                <div class="chart-controls">
                    <label for="categoryColumn">Agrupar por (Categor√≠as):</label>
                    <select id="categoryColumn"></select>
                    <label for="valueColumn">Calcular (Valores):</label>
                    <select id="valueColumn"></select>
                    <button id="generateChartBtn" class="btn btn-blue">Generar Gr√°fico</button>
                </div>
                <div class="chart-container">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
            <div class="modal-footer">
                 <button class="btn" onclick="document.getElementById('chartModal').style.display='none'">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" defer></script>
    <script src="script/tabla.js" defer></script>
</body>
</html>